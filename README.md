# ChatRoom
# 局域网聊天系统

程序实现局域网内的聊天功能，包括服务器端程序和客户端程序两部分。服务器端具有建立侦听服务，转发聊天信息，响应用户下线，统计在线人数，发送系统消息的功能。客户端具有请求登陆，请求下线，发送聊天信息，接收聊天信息，接收系统信息，发送与接收文件的功能。


首先有两个Java project，一个是服务器端project（ChatServer），另一个是客户端project（ChatClient）。
客户端的功能有：登陆、注册、群发消息、单人聊天、显示在线人数、显示在线用户、群发文件、单人发送文件、清除聊天记录。
服务器端的功能有：开启服务器，关闭服务器、发送系统消息、强制下线、显示在线用户、显示在线人数、显示用户的对话信息。



![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/11.png)

![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/12.png)

## 注册流程：
1.	服务器端启动服务器，开启一个线程，不断的接受客户端发送过来的信息。
2.	客户端注册用户，填写用户名，密码，确定密码（对用户名，密码，确认密码为空进行了判断，并且对密码和确认密码进行了校对并且进行相关的提示）点击注册后，客户端将用户名，密码和用户操作的类型（登录，注册）封装为一个javaBean（User对象）。然后通过对象流，将这个User对象传送给服务器端。
3.	服务器端接受到客户端发送过来的User对象，通过User对象的getType（）方法获取用户的操作类型。通过获取得知用户是注册操作，然后通过后台的数据库操作类对User对象进行解析和对数据库的信息进行匹配，如果用户名已经存在，或者操作数据库失败，则返回false，如果添加用户信息成功，则返回true。服务器端通过返回的结果将数据封装入一个javaBean（Message对象），Message类指定信息的类型（通过接口MessageType对类型进行定义），信息的内容和信息的发送时间、信息的发送者和信息的接受者。服务器端将Message对象通过对象流的形式又发送给客户端。
4.	客户端接受到服务器端发送过来的Message对象，通过getMessageType（）得知信息的类型，并进行相应的操作。得知发送过来的类型是注册成功类型，客户端会提示注册成功（如果是注册失败的类型，则客户端会返回注册失败）

![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/1.png)

## 登陆流程：
1.	客户端通过注册后的用户名和密码进行登录操作。（对用户名和密码为空进行了判断和提示）。客户端又会将用户名和密码和操作类型（登录类型）封装为User对象，传送给客户端。
2.	服务器端接受到客户端发送过来的User对象，获取用户的操作类型，得知用户的是登录类型，然后通过后台的数据库操作类对User对象进行解析和对数据库的信息进行匹配，如果数据库有符合的用户，则放回true否则返回false。服务器端将返回的信息封装为Message对象，指定其类型为登录成功（或登录失败），然后通过对象流传给客户端。如果是登录成功，则服务器端会专门开一条线程为登录成功的这个用户进行服务，专门接受这个客户端的信息。并将这个线程放入一个专门管理线程的集合（通过这个集合可以对线程进行随时的读取）。
3.	客户端接受到服务器发送过来的Message对象，通过Message的类型进行相应的操作（登录成功的类型，客户端提示登录成功并进去群聊界面，并将这个群聊界面放入一个专门管理群聊界面的集合（通过这个集合可以将信息显示在特定的群聊界面上）；登录失败的类型，则客户端提示登录失败）。登录成功后，客户端登陆成功之后，客户端通过发送信息（指定信息类型）提醒服务器端修改在线用户和在线人数，服务器再提醒所有用户修改在线用户和在线人数，然后客户端开启一个专门接受信息的线程。

![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/2.png)



## 群发信息：
1.	客户端通过文本域输入信息，然后将信息内容，信息发送的时间，信息的发送者（所有人）信息的发送者，信息的类型（群发消息）封装为一个Message对象，通过对象流传送给服务器。
2.	服务器端通过信息的类型（群发消息）进行操作，然后取出专门管理线程的集合里的每一个元素，获得每一个与客户端连接的线程，然后把信息转发给每一个在线用户。


## 群发文件：
1.	客户端点击发送文件，打开文件选择器，选择好文件，客户端将文件的名字和发送者和信息类型（群发文件）等信息封装入Message对象中，发送给服务器端。并且将文件发送给服务器。
2.	服务器端解析发送过来的信息类型（群发文件），然后取出从集合中取出所有与客户端连接的线程，将文件转发给每个在线用户。并发送系统消息：（发送者）给所有人发送了（文件名）文件。


## 单人聊天：
1.	客户端选择用户点击单人聊天（不能和自己聊天）。弹出单人聊天界面，在文本域里输入信息，点击发送。
2.	客户端将信息封装入Message对象，并指定类型为单人聊天，指定发送者和接受者。
3.	服务器端收到客户端发送过来的Message对象，解析Message对象，得到接受者，通过接受者找到集合中对应的线程，取出来并转发消息。


## 单人发送文件
1.	客户端在单人聊天界面点击发送文件，打开文件选择器，选择好文件，客户端将文件的名字和发送者、接受者和信息类型（单人发送文件）等信息封装入Message对象中，发送给服务器端。并且将文件发送给服务器。
2.	服务器端接收到客户端发送过来的Message对象，并进行解析，得知接受者是谁，然后从集合中取出对应的线程，然后将文件转发给用户。

## 服务器界面


![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/3.png)

## 群聊界面

![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/4.png)

## 单人聊天界面

![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/5.png)

## 群聊

![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/6.jpg)

## 群发文件
![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/7.jpg)

## 单人聊天

![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/8.png)

## 单人发送文件

![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/9.png)

## 系统消息发送
![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/10.jpg)

## 强制下线
![image](https://github.com/cckevincyh/ChatRoom/blob/master/img/13.png)
